---
title: "Revisiting Knudson's 2 Hit Hypothesis: A Lesson in Data Reproducibility"
author: "Daniel Pique"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{knudson}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

Knudson's ["Mutation and cancer: statistical study of retinoblastoma"](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC389051/) (1971) forms the basis for the 2-hit hypothesis in cancer and has 8000+ citations in the biomedical literature. Here, I attempt to reproduce [Figure 1](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC389051/?page=4) from this paper using the data provided in [Table 1](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC389051/?page=2), which is also provided within this package as the object `k`. 


## Loading the `knudson` library

We'll also load some other packages that we'll need for the rest of the analysis. 

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  warning=FALSE,
  error=FALSE, 
  message=FALSE
)
```


```{r warning=FALSE, error=FALSE, message=FALSE, fig.height = 4, fig.width = 7}
library(knudson)
library(tidyverse)
library(patchwork)
library(png)
library(knitr)
library(kableExtra)

```

## Looking at Table 1

Let's load a screenshot of Table 1 taken from the original article. We'll also peek at a machine readable form of the table, `k`, that is included in the `knudson` package.


```{r , fig.height = 4, fig.width = 7}
t1_png <- png::readPNG("knudson_tab1_1971_PNAS.png")

t1_png_gg <- ggplot() +  
  annotation_custom(grid::rasterGrob(t1_png, 
                               width = unit(1,"npc"), 
                               height = unit(1,"npc")), 
                    -Inf, Inf, -Inf, Inf)
t1_png_gg

# `k` is a machine-readable version of Table 1 
kable(knudson::k) %>%
  kable_styling(position="center") %>%
  scroll_box(width = "100%", height = "200px")

```

## Comparing Figure 1 with Table 1

Let's load a screenshot of Figure 1 taken from the original article. 
```{r, echo = TRUE, fig.height = 6, fig.width = 4.5}
knud_png <- png::readPNG("knudson_fig1_1971_PNAS.png")

fig1_orig <- ggplot() +  
  annotation_custom(grid::rasterGrob(knud_png, 
                               width = unit(1,"npc"), 
                               height = unit(1,"npc")), 
                    -Inf, Inf, -Inf, Inf)

fig1_orig
```

Of note, the x-axis in Figure 1 ends at 60 months. However, there are 2 patients in Table 1 who are diagnosed at or after age 60 months. 

To make sure, let's count the number of data points represented in this figure and compare with the expected number of data points. I've included an annotated screenshot of Figure 1 that counts the number of points.  

```{r, fig.height = 6, fig.width = 4.5}
knud_png_annot <- png::readPNG("knudson_fig1_1971_PNAS_annot.png")

knud_fig1_annot <- ggplot() +  
  annotation_custom(grid::rasterGrob(knud_png_annot, 
                               width = unit(1,"npc"), 
                               height = unit(1,"npc")), 
                    -Inf, Inf, -Inf, Inf)
knud_fig1_annot
```

There are fewer data points than expected based on the legend (20 unilateral and 17 bilateral cases compared with 25 and 23 expected, respectively).

Why are there fewer points in the plot than expected? The y-axis reports the "fraction of cases not yet diagnosed at the age indicated." Therefore, it is possible that the author collapsed cases occuring in the same month into a single data point. 

We'll recreate figure 1 with this approach in mind.


## Recreating Figure 1

```{r, fig.height = 6, fig.width = 8}

k2 <- k %>%
  arrange(side, -age_at_dx) %>%
  group_by(side) %>%
  mutate(idx_sum = 1 / length(side), 
         prop_of_tot = cumsum(idx_sum) - idx_sum) %>%
  ungroup %>%
  mutate(side=factor(side, levels=c("unilat", "bilat"))) %>%
  group_by(side, age_at_dx) %>%
  ## collapse cases occuring in the same month into a single data point
  filter(prop_of_tot == min(prop_of_tot)) 

y_axis_seq <- c(0.01, seq(0.02, 0.1, 0.02), seq(0.2, 1, 0.2))
y_axis_seq_char = format(y_axis_seq, digits=2)

fig1 <- ggplot(k2, aes(x=age_at_dx, y = prop_of_tot, group=side, shape=side)) +
  geom_point() +
  scale_shape_manual(values=c(21,22), 
                     labels=c("Unilateral Cases (25)","Bilateral Cases (23)")) + 
  scale_y_log10(breaks = y_axis_seq, 
                limits = c(0.01, 1.04), 
                labels = as.character(gsub("^0\\.", "\\.", y_axis_seq_char)),
                expand = c(0, 0)) +
  scale_x_continuous(breaks = seq(0,60, 10), 
                     limits = c(-0.1, 75), 
                     expand = c(0, 0)) +
  xlab("AGE IN MONTHS") + 
  ylab("FRACTION OF CASES NOT YET DIAGNOSED AT AGE INDICATED") +
  theme_classic() + 
  theme(aspect.ratio = 1.5, 
        legend.position = c(0.3,0.16), 
        legend.title=element_blank()) +
  ggtitle("Reproduced in R") + geom_abline(intercept = 0, slope = -1/30, color="black", 
                 linetype="solid", size=0.5) + 
  stat_function(fun = function(t) -4 * 10^{-4} *t^2, linetype="longdash", color="black")

k2_missing <- k2 %>% filter(age_at_dx >= 60 | {age_at_dx == 47 & side == "unilat"})

fig1_missing <- fig1 + 
  geom_point(data = k2_missing, aes(x=age_at_dx, y = prop_of_tot), pch=21, fill=NA, color = "red", size=4.5)


fig1_missing + fig1_orig + plot_layout(widths = c(1, 1.35))
```


## Missing data

There are 3 data points (red circles) missing from the original Figure 1. 

Two data points from patients age >=60 (look along the base of the x-axis) are missing, and a third data point for unilateral retinoblastoma patient 08997, age 47 months, is also missing. 
The x-axis stops at 60 in the original figure and can account for the two missing data points.

## Fitted curves

We also note that the curve $logS = -4 \times 10^{-4}t^2$ (black dotted line) is a much better fit than the curve $logS = -4 * 10^{-5}t^2$ (red dotted line) reported in the paper, suggesting that the exponent from the equation reported in the paper is incorrect. Let's take a look:

```{r, fig.height = 6, fig.width = 4}
fig1 + 
  stat_function(fun = function(t) -4 * 10^{-5} *t^2, linetype="longdash", color="red")
```


## Conclusions

- This vignette highlights the importance of data reproducibility in the scientific literature.

- Figure 1 from Knusdon 1971 is mostly reproducibile.  

- However, there are some inconsistencies between the data reported in Table 1 and the data plotted in Figure 1. 3 data points included in the dataset were missing from the Figure, partly due to an x-axis that was not sufficiently wide.

- The fitted curve for the unilateral cases has an error in the exponent.

- These inconsistencies do not change the conclusions of this paper.

- Peer review is important! Notice that this paper was ['communicated'](https://www.pnas.org/content/106/37/15518) to PNAS. This means that it was 'believed... (by a NAS member)... to be of sufficient significance to warrant publication.' Basically, this paper did not undergo standard peer review, which opens the door for the unchecked mistakes we observed.
(Fortunately, PNAS [discontinued communicated manuscripts](https://www.pnas.org/content/106/37/15518) in 2010)




